/**
 * Generated by orval v8.1.0 üç∫
 * Do not edit manually.
 * OnSurvey API Docs
 * OnSurvey Spring boot Api Document ÏûÖÎãàÎã§.
 * OpenAPI spec version: 0.0.1
 */

import type {
	MutationFunction,
	QueryClient,
	UseMutationOptions,
	UseMutationResult,
} from "@tanstack/react-query";
import { useMutation } from "@tanstack/react-query";
import { apiClient } from "../axios/orvalMutator";
import type { UploadBody } from ".././model";

type SecondParameter<T extends (...args: never) => unknown> = Parameters<T>[1];

/**
 * Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌõÑ Public URLÏùÑ Î∞òÌôòÌï©ÎãàÎã§. URLÏùÄ Ïù¥ÌõÑ Í≤åÏãúÍ∏Ä ÏóîÌã∞Ìã∞Ïùò POST ÏöîÏ≤≠ÏóêÏÑú image_url ÌïÑÎìúÎ°ú Ï†ÄÏû•Ìï©ÎãàÎã§.
 * @summary Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
 */
export const getUploadUrl = () => {
	return `/v1/images`;
};

export const upload = async (
	uploadBody: UploadBody,
	options?: RequestInit,
): Promise<Blob> => {
	const formData = new FormData();
	formData.append(`file`, uploadBody.file);

	return apiClient<Blob>(getUploadUrl(), {
		...options,
		method: "POST",
		body: formData,
	});
};

export const getUploadMutationOptions = <
	TError = Blob,
	TContext = unknown,
>(options?: {
	mutation?: UseMutationOptions<
		Awaited<ReturnType<typeof upload>>,
		TError,
		{ data: UploadBody },
		TContext
	>;
	request?: SecondParameter<typeof apiClient>;
}): UseMutationOptions<
	Awaited<ReturnType<typeof upload>>,
	TError,
	{ data: UploadBody },
	TContext
> => {
	const mutationKey = ["upload"];
	const { mutation: mutationOptions, request: requestOptions } = options
		? options.mutation &&
			"mutationKey" in options.mutation &&
			options.mutation.mutationKey
			? options
			: { ...options, mutation: { ...options.mutation, mutationKey } }
		: { mutation: { mutationKey }, request: undefined };

	const mutationFn: MutationFunction<
		Awaited<ReturnType<typeof upload>>,
		{ data: UploadBody }
	> = (props) => {
		const { data } = props ?? {};

		return upload(data, requestOptions);
	};

	return { mutationFn, ...mutationOptions };
};

export type UploadMutationResult = NonNullable<
	Awaited<ReturnType<typeof upload>>
>;
export type UploadMutationBody = UploadBody;
export type UploadMutationError = Blob;

/**
 * @summary Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
 */
export const useUpload = <TError = Blob, TContext = unknown>(
	options?: {
		mutation?: UseMutationOptions<
			Awaited<ReturnType<typeof upload>>,
			TError,
			{ data: UploadBody },
			TContext
		>;
		request?: SecondParameter<typeof apiClient>;
	},
	queryClient?: QueryClient,
): UseMutationResult<
	Awaited<ReturnType<typeof upload>>,
	TError,
	{ data: UploadBody },
	TContext
> => {
	return useMutation(getUploadMutationOptions(options), queryClient);
};
